# Path Planning éšœç¢ç‰©å‚æ•°è¯´æ˜

## ğŸ“‹ éšœç¢ç‰©å‚æ•°æ¦‚è¿°

Path Planning ä¸­çš„éšœç¢ç‰©å‚æ•°ä¸»è¦æ ¹æ®ä»¥ä¸‹å‡ ä¸ªå› ç´ å†³å®šï¼š

### 1. åœ°å›¾æ•°æ®æ ¼å¼ï¼ˆOccupancyGridæ ‡å‡†ï¼‰

åœ¨ROS2çš„`nav_msgs/OccupancyGrid`æ¶ˆæ¯ä¸­ï¼Œæ¯ä¸ªæ …æ ¼çš„å€¼èŒƒå›´æ˜¯ï¼š
- **0**: å®Œå…¨è‡ªç”±ç©ºé—´ï¼ˆfree spaceï¼‰
- **100**: å®Œå…¨å æ®ï¼ˆoccupied/obstacleï¼‰
- **-1**: æœªçŸ¥åŒºåŸŸï¼ˆunknownï¼‰
- **1-99**: éƒ¨åˆ†å æ®çš„æ¦‚ç‡å€¼

### 2. å…³é”®å‚æ•°è¯´æ˜

#### `obstacle_threshold` (é»˜è®¤: 50)

**ä½œç”¨**: åˆ¤æ–­æ …æ ¼æ˜¯å¦ä¸ºéšœç¢ç‰©çš„é˜ˆå€¼

**å†³å®šä¾æ®**:
- ROS2 Navigationæ ‡å‡†ï¼šå€¼ â‰¥ 50 è¢«è§†ä¸ºéšœç¢ç‰©
- è¿™æ˜¯`OccupancyGrid`æ¶ˆæ¯çš„æ ‡å‡†çº¦å®š
- å…è®¸å¤„ç†æ¦‚ç‡åœ°å›¾ï¼ˆSLAMç”Ÿæˆçš„åœ°å›¾å¯èƒ½æœ‰ä¸­é—´å€¼ï¼‰

**ä»£ç ä½ç½®**:
```python
# path_planning_service.py
obstacle_mask = grid >= 50  # å€¼>=50è§†ä¸ºéšœç¢ç‰©
cell_value = inflated_map[gy, gx]
return cell_value < self.obstacle_threshold  # å€¼<50æ‰å¯é€šè¿‡
```

**ä¸ºä»€ä¹ˆæ˜¯50ï¼Ÿ**
- è¿™æ˜¯ROS Navigation Stackçš„æ ‡å‡†é˜ˆå€¼
- å¹³è¡¡äº†å®‰å…¨æ€§å’Œå¯è¾¾æ€§
- å…è®¸å¤„ç†ä¸ç¡®å®šåŒºåŸŸï¼ˆ1-49è¢«è§†ä¸ºå¯èƒ½è‡ªç”±ï¼Œä½†éœ€è¦è°¨æ…ï¼‰

#### `inflation_radius` (é»˜è®¤: 0.4ç±³)

**ä½œç”¨**: éšœç¢ç‰©è†¨èƒ€åŠå¾„ï¼Œç”¨äºè€ƒè™‘æœºå™¨äººå°ºå¯¸

**å†³å®šä¾æ®**:
- **æœºå™¨äººåŠå¾„**: `robot_radius = 0.2ç±³`ï¼ˆTurtleBot Burgerï¼‰
- **å®‰å…¨è¾¹è·**: é¢å¤–0.2ç±³çš„å®‰å…¨ç¼“å†²
- **æ€»è†¨èƒ€åŠå¾„**: 0.2 + 0.2 = 0.4ç±³

**è®¡ç®—æ–¹å¼**:
```python
# å°†ä¸–ç•Œåæ ‡çš„è†¨èƒ€åŠå¾„è½¬æ¢ä¸ºæ …æ ¼æ•°
inflation_cells = ceil(inflation_radius / map_resolution)
# ä¾‹å¦‚: 0.4m / 0.1m = 4ä¸ªæ …æ ¼
```

**è†¨èƒ€ç®—æ³•**:
- å¯¹æ¯ä¸ªéšœç¢ç‰©æ …æ ¼ï¼Œåœ¨å…¶å‘¨å›´åŠå¾„ä¸º`inflation_radius`çš„åœ†å½¢åŒºåŸŸå†…æ ‡è®°ä¸ºéšœç¢ç‰©
- ä½¿ç”¨åœ†å½¢è†¨èƒ€ï¼ˆä¸æ˜¯æ–¹å½¢ï¼‰ï¼Œæ›´ç¬¦åˆæœºå™¨äººå®é™…å½¢çŠ¶

#### `robot_radius` (é»˜è®¤: 0.2ç±³)

**ä½œç”¨**: æœºå™¨äººåŠå¾„ï¼Œç”¨äºè®¡ç®—å®‰å…¨è·¯å¾„

**å†³å®šä¾æ®**:
- TurtleBot3 Burgerçš„å®é™…å°ºå¯¸
- ç”¨äºéšœç¢ç‰©è†¨èƒ€è®¡ç®—
- ç¡®ä¿è·¯å¾„è§„åˆ’æ—¶æœºå™¨äººä¸ä¼šç¢°æ’

### 3. åœ°å›¾ç”Ÿæˆä¸­çš„éšœç¢ç‰©å€¼

åœ¨`simple_map_simulator.py`ä¸­ï¼š

```python
# éšœç¢ç‰©è¢«è®¾ç½®ä¸º100ï¼ˆå®Œå…¨å æ®ï¼‰
grid[20:30, 20:35] = 100  # çŸ©å½¢éšœç¢ç‰©
grid[y, x] = 100          # åœ†å½¢éšœç¢ç‰©
```

**ä¸ºä»€ä¹ˆä½¿ç”¨100ï¼Ÿ**
- 100è¡¨ç¤ºå®Œå…¨ç¡®å®šçš„éšœç¢ç‰©
- ç¬¦åˆOccupancyGridæ ‡å‡†
- ç¡®ä¿è·¯å¾„è§„åˆ’ç®—æ³•èƒ½æ­£ç¡®è¯†åˆ«

### 4. å‚æ•°å…³ç³»å›¾

```
åœ°å›¾æ …æ ¼å€¼ (0-100)
    â”‚
    â”œâ”€ [0-49]   â†’ è‡ªç”±ç©ºé—´ï¼ˆå¯é€šè¿‡ï¼‰
    â”œâ”€ [50-99]  â†’ éƒ¨åˆ†å æ®ï¼ˆè§†ä¸ºéšœç¢ç‰©ï¼‰
    â””â”€ [100]    â†’ å®Œå…¨å æ®ï¼ˆéšœç¢ç‰©ï¼‰
         â”‚
         â”œâ”€ åº”ç”¨ obstacle_threshold (â‰¥50)
         â”‚
         â”œâ”€ åº”ç”¨ inflation_radius (0.4m)
         â”‚   â””â”€ è€ƒè™‘ robot_radius (0.2m) + å®‰å…¨è¾¹è· (0.2m)
         â”‚
         â””â”€ ç”Ÿæˆè†¨èƒ€åçš„åœ°å›¾
             â””â”€ ç”¨äºA*è·¯å¾„è§„åˆ’
```

### 5. å‚æ•°è°ƒæ•´å»ºè®®

#### å¦‚æœæœºå™¨äººç»å¸¸ç¢°æ’ï¼š
- **å¢åŠ  `inflation_radius`**: 0.4 â†’ 0.5 æˆ– 0.6
- **å¢åŠ  `robot_radius`**: å¦‚æœå®é™…æœºå™¨äººæ›´å¤§

#### å¦‚æœè·¯å¾„è§„åˆ’å¤±è´¥ï¼ˆæ‰¾ä¸åˆ°è·¯å¾„ï¼‰ï¼š
- **å‡å°‘ `inflation_radius`**: 0.4 â†’ 0.3
- **é™ä½ `obstacle_threshold`**: 50 â†’ 40ï¼ˆæ›´æ¿€è¿›ï¼Œä½†å¯èƒ½ä¸å®‰å…¨ï¼‰

#### å¦‚æœä½¿ç”¨SLAMç”Ÿæˆçš„åœ°å›¾ï¼š
- **ä¿æŒ `obstacle_threshold = 50`**: è¿™æ˜¯æ ‡å‡†å€¼
- **å¯èƒ½éœ€è¦è°ƒæ•´**: æ ¹æ®SLAMç®—æ³•çš„ç½®ä¿¡åº¦

### 6. å®é™…è®¡ç®—ç¤ºä¾‹

å‡è®¾åœ°å›¾åˆ†è¾¨ç‡ = 0.1ç±³/æ …æ ¼ï¼š

```
åŸå§‹éšœç¢ç‰©: 1ä¸ªæ …æ ¼ (0.1m Ã— 0.1m)
    â”‚
    â”œâ”€ inflation_radius = 0.4m
    â”œâ”€ inflation_cells = ceil(0.4 / 0.1) = 4ä¸ªæ …æ ¼
    â”‚
    â””â”€ è†¨èƒ€å: åŠå¾„4æ …æ ¼çš„åœ†å½¢åŒºåŸŸ
        â””â”€ çº¦ 4Â² Ã— Ï€ â‰ˆ 50ä¸ªæ …æ ¼è¢«æ ‡è®°ä¸ºéšœç¢ç‰©
```

### 7. é…ç½®æ–‡ä»¶ä½ç½®

æ‰€æœ‰å‚æ•°åœ¨ `config/path_planning_params.yaml` ä¸­å®šä¹‰ï¼š

```yaml
path_planning_service:
  ros__parameters:
    inflation_radius: 0.4      # éšœç¢ç‰©è†¨èƒ€åŠå¾„ï¼ˆç±³ï¼‰
    robot_radius: 0.2          # æœºå™¨äººåŠå¾„ï¼ˆç±³ï¼‰
    obstacle_threshold: 50     # éšœç¢ç‰©é˜ˆå€¼ï¼ˆ0-100ï¼‰
```

### 8. æ€»ç»“

éšœç¢ç‰©å‚æ•°çš„å†³å®šä¾æ®ï¼š

1. **obstacle_threshold = 50**: 
   - ROS2 Navigationæ ‡å‡†
   - OccupancyGridæ¶ˆæ¯çº¦å®š

2. **inflation_radius = 0.4m**:
   - robot_radius (0.2m) + å®‰å…¨è¾¹è· (0.2m)
   - ç¡®ä¿è·¯å¾„å®‰å…¨

3. **åœ°å›¾éšœç¢ç‰©å€¼ = 100**:
   - OccupancyGridæ ‡å‡†ï¼ˆå®Œå…¨å æ®ï¼‰
   - ç¡®ä¿æ­£ç¡®è¯†åˆ«

è¿™äº›å‚æ•°å…±åŒç¡®ä¿ï¼š
- âœ… è·¯å¾„é¿å¼€çœŸå®éšœç¢ç‰©
- âœ… è€ƒè™‘æœºå™¨äººå°ºå¯¸
- âœ… ä¿æŒå®‰å…¨è¾¹è·
- âœ… ç¬¦åˆROS2æ ‡å‡†

