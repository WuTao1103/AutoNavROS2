# éšœç¢ç‰©åˆ¤æ–­æœºåˆ¶å¯¹æ¯”

## ğŸ“Š ä¸¤ä¸ªç³»ç»Ÿçš„éšœç¢ç‰©åˆ¤æ–­æ–¹å¼

### 1. Simple Map Simulatorï¼ˆåœ°å›¾ç”Ÿæˆå™¨ï¼‰

**ä½œç”¨**: ç”Ÿæˆåœ°å›¾å¹¶è®¾ç½®éšœç¢ç‰©å€¼

**åˆ¤æ–­æ–¹å¼**: **ç›´æ¥èµ‹å€¼**

```python
# simple_map_simulator.py

# æ–¹å¼1: ç›´æ¥è®¾ç½®éšœç¢ç‰©å€¼ä¸º 100
grid[20:30, 20:35] = 100  # çŸ©å½¢éšœç¢ç‰©
grid[y, x] = 100          # åœ†å½¢éšœç¢ç‰©

# æ–¹å¼2: è¾¹ç•Œå¢™
grid[0, :] = 100   # é¡¶éƒ¨å¢™
grid[-1, :] = 100  # åº•éƒ¨å¢™
grid[:, 0] = 100   # å·¦ä¾§å¢™
grid[:, -1] = 100  # å³ä¾§å¢™
```

**å…³é”®ç‚¹**:
- âœ… **ç›´æ¥èµ‹å€¼**: éšœç¢ç‰©ä½ç½®ç›´æ¥è®¾ç½®ä¸º `100`
- âœ… **æ— åˆ¤æ–­é€»è¾‘**: ä¸éœ€è¦åˆ¤æ–­ï¼Œç›´æ¥åˆ›å»ºéšœç¢ç‰©
- âœ… **å€¼å›ºå®š**: æ‰€æœ‰éšœç¢ç‰©éƒ½æ˜¯ `100`ï¼ˆå®Œå…¨å æ®ï¼‰

**ä»£ç ç¤ºä¾‹**:
```python
def create_room_with_obstacles(self):
    grid = np.zeros((100, 100), dtype=np.int8)
    
    # éšœç¢ç‰©1: çŸ©å½¢
    grid[20:30, 20:35] = 100  # ç›´æ¥èµ‹å€¼100
    
    # éšœç¢ç‰©2: åœ†å½¢
    for y in range(...):
        for x in range(...):
            if (x - center_x)**2 + (y - center_y)**2 <= radius**2:
                grid[y, x] = 100  # ç›´æ¥èµ‹å€¼100
    
    return grid
```

---

### 2. Path Planning Serviceï¼ˆè·¯å¾„è§„åˆ’æœåŠ¡ï¼‰

**ä½œç”¨**: è¯»å–åœ°å›¾å¹¶åˆ¤æ–­å“ªäº›æ …æ ¼æ˜¯éšœç¢ç‰©

**åˆ¤æ–­æ–¹å¼**: **é˜ˆå€¼æ¯”è¾ƒ**

```python
# path_planning_service.py

# åˆ¤æ–­1: è¯†åˆ«éšœç¢ç‰©ï¼ˆç”¨äºè†¨èƒ€ï¼‰
binary = (grid > self.obstacle_threshold).astype(np.uint8)
# obstacle_threshold = 50
# æ‰€ä»¥: grid > 50  â†’  è§†ä¸ºéšœç¢ç‰©

# åˆ¤æ–­2: æ£€æŸ¥æ …æ ¼æ˜¯å¦å¯é€šè¿‡
cell_value = inflated_map[gy, gx]
return cell_value < self.obstacle_threshold
# å¦‚æœå€¼ < 50  â†’  å¯ä»¥é€šè¿‡
# å¦‚æœå€¼ >= 50 â†’  æ˜¯éšœç¢ç‰©ï¼Œä¸èƒ½é€šè¿‡
```

**å…³é”®ç‚¹**:
- âœ… **é˜ˆå€¼åˆ¤æ–­**: ä½¿ç”¨ `obstacle_threshold = 50` ä½œä¸ºé˜ˆå€¼
- âœ… **æ¯”è¾ƒæ“ä½œ**: `grid > 50` æˆ– `cell_value < 50`
- âœ… **åŠ¨æ€åˆ¤æ–­**: æ ¹æ®åœ°å›¾å€¼åŠ¨æ€åˆ¤æ–­ï¼Œä¸æ˜¯å›ºå®šå€¼

**ä»£ç æµç¨‹**:

```python
# æ­¥éª¤1: æ¥æ”¶åœ°å›¾
def map_callback(self, msg):
    self.map_data = np.array(msg.data).reshape(height, width)
    # map_data åŒ…å« 0-100 çš„å€¼
    
# æ­¥éª¤2: è¯†åˆ«éšœç¢ç‰©ï¼ˆç”¨äºè†¨èƒ€ï¼‰
def _inflate_obstacles(self, grid, inflation_cells):
    # åˆ¤æ–­: å“ªäº›æ …æ ¼æ˜¯éšœç¢ç‰©ï¼Ÿ
    binary = (grid > self.obstacle_threshold).astype(np.uint8)
    # grid > 50  â†’  binary = 1 (éšœç¢ç‰©)
    # grid <= 50 â†’  binary = 0 (è‡ªç”±ç©ºé—´)
    
    # æ‰¾åˆ°æ‰€æœ‰éšœç¢ç‰©ä½ç½®
    obstacle_y, obstacle_x = np.where(binary > 0)
    
    # è†¨èƒ€éšœç¢ç‰©...
    
# æ­¥éª¤3: æ£€æŸ¥è·¯å¾„ç‚¹æ˜¯å¦å¯é€šè¿‡
def is_valid(self, gx, gy, inflated_map):
    cell_value = inflated_map[gy, gx]
    # åˆ¤æ–­: å€¼ < 50 æ‰èƒ½é€šè¿‡
    return cell_value < self.obstacle_threshold
```

---

## ğŸ”„ å®Œæ•´æµç¨‹å¯¹æ¯”

### Simple Map Simulator æµç¨‹

```
å¼€å§‹
  â†“
åˆ›å»ºç©ºåœ°å›¾ (å…¨0)
  â†“
ç›´æ¥è®¾ç½®éšœç¢ç‰©ä½ç½® = 100
  â”œâ”€ grid[20:30, 20:35] = 100  (çŸ©å½¢)
  â”œâ”€ grid[y, x] = 100           (åœ†å½¢)
  â””â”€ grid[0, :] = 100           (è¾¹ç•Œ)
  â†“
å‘å¸ƒåœ°å›¾ (OccupancyGrid)
  â””â”€ data: [0, 0, 100, 100, 0, ...]
```

**ç‰¹ç‚¹**: 
- ç›´æ¥èµ‹å€¼ï¼Œæ— éœ€åˆ¤æ–­
- éšœç¢ç‰©å€¼å›ºå®šä¸º 100

### Path Planning Service æµç¨‹

```
æ¥æ”¶åœ°å›¾ (OccupancyGrid)
  â†“
æå–åœ°å›¾æ•°æ®: [0, 0, 100, 100, 0, ...]
  â†“
åˆ¤æ–­éšœç¢ç‰©: grid > 50?
  â”œâ”€ 100 > 50 â†’ æ˜¯éšœç¢ç‰© âœ“
  â”œâ”€ 50 > 50  â†’ æ˜¯éšœç¢ç‰© âœ“
  â””â”€ 0 > 50   â†’ ä¸æ˜¯éšœç¢ç‰© âœ—
  â†“
è†¨èƒ€éšœç¢ç‰© (è€ƒè™‘æœºå™¨äººå°ºå¯¸)
  â†“
è·¯å¾„è§„åˆ’æ—¶æ£€æŸ¥: cell_value < 50?
  â”œâ”€ 0 < 50   â†’ å¯é€šè¿‡ âœ“
  â”œâ”€ 50 < 50  â†’ ä¸å¯é€šè¿‡ âœ—
  â””â”€ 100 < 50 â†’ ä¸å¯é€šè¿‡ âœ—
```

**ç‰¹ç‚¹**:
- ä½¿ç”¨é˜ˆå€¼åŠ¨æ€åˆ¤æ–­
- æ”¯æŒæ¦‚ç‡åœ°å›¾ï¼ˆ1-99çš„å€¼ï¼‰

---

## ğŸ“‹ åˆ¤æ–­æ ‡å‡†å¯¹æ¯”è¡¨

| ç³»ç»Ÿ | åˆ¤æ–­æ–¹å¼ | åˆ¤æ–­æ¡ä»¶ | å€¼èŒƒå›´ | ç¤ºä¾‹ |
|------|---------|---------|--------|------|
| **Simple Map Simulator** | ç›´æ¥èµ‹å€¼ | `grid[y, x] = 100` | å›ºå®š100 | `grid[20:30, 20:35] = 100` |
| **Path Planning Service** | é˜ˆå€¼æ¯”è¾ƒ | `grid > 50` | åŠ¨æ€åˆ¤æ–­ | `cell_value < 50` |

---

## ğŸ’¡ å…³é”®ä»£ç ä½ç½®

### Simple Map Simulator

```python
# simple_map_simulator.py:79-109
def create_room_with_obstacles(self):
    grid = np.zeros((100, 100), dtype=np.int8)
    
    # ç›´æ¥è®¾ç½®éšœç¢ç‰© = 100
    grid[20:30, 20:35] = 100  # çŸ©å½¢éšœç¢ç‰©
    grid[y, x] = 100          # åœ†å½¢éšœç¢ç‰©
    
    return grid
```

### Path Planning Service

```python
# path_planning_service.py:119
# åˆ¤æ–­éšœç¢ç‰©
binary = (grid > self.obstacle_threshold).astype(np.uint8)
# obstacle_threshold = 50

# path_planning_service.py:172
# æ£€æŸ¥æ˜¯å¦å¯é€šè¿‡
cell_value = inflated_map[gy, gx]
return cell_value < self.obstacle_threshold
```

---

## ğŸ¯ æ€»ç»“

### Simple Map Simulator
- **è§’è‰²**: åœ°å›¾åˆ›å»ºè€…
- **æ–¹æ³•**: ç›´æ¥èµ‹å€¼ `100`
- **ç›®çš„**: ç”ŸæˆåŒ…å«éšœç¢ç‰©çš„åœ°å›¾

### Path Planning Service
- **è§’è‰²**: åœ°å›¾ä½¿ç”¨è€…
- **æ–¹æ³•**: é˜ˆå€¼åˆ¤æ–­ `> 50` æˆ– `< 50`
- **ç›®çš„**: è¯†åˆ«éšœç¢ç‰©å¹¶è§„åˆ’å®‰å…¨è·¯å¾„

**ä¸¤è€…é…åˆ**:
1. Simulator åˆ›å»ºåœ°å›¾ï¼Œéšœç¢ç‰©è®¾ä¸º `100`
2. Service è¯»å–åœ°å›¾ï¼Œåˆ¤æ–­ `> 50` ä¸ºéšœç¢ç‰©
3. Service è§„åˆ’è·¯å¾„ï¼Œç¡®ä¿ `cell_value < 50` æ‰é€šè¿‡

